---
import BaseLayout from "../../layouts/BaseLayout.astro";
import BlogPostPreview from "../../components/BlogPostPreview.astro";

const { frontmatter } = Astro.props;

export async function getStaticPaths() {
  const allPosts = await Astro.glob("../posts/*.md");

  const uniqueTags = [
    ...new Set(allPosts.flatMap((post) => post.frontmatter.tags)),
  ];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) =>
      post.frontmatter.tags?.includes(tag)
    );

    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout pageTitle={tag}>
  {
    posts.length >= 0 ? (
      <div id="post-grid" class="grid sm:grid-cols-2 gap-6 lg:gap-12">
        {posts.map((post) => (
          <BlogPostPreview
            image={post.frontmatter.image.url}
            alt={post.frontmatter.image.alt}
            url={post.url}
            title={post.frontmatter.title}
            excerpt={post.frontmatter.description}
            author={post.frontmatter.author}
            pubDate={post.frontmatter.pubDate}
          />
        ))}
      </div>
    ) : (
      <div class="text-center">
        <h2>No posts yet</h2>
      </div>
    )
  }
</BaseLayout>
